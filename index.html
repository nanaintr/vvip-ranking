<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>ìŠ¤í”¼ë“œì˜¨ VVIP 3% ìŠˆí¼ ì ë¦½ í˜„í™©</title>
  <meta name="robots" content="noindex,nofollow" />
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdn.jsdelivr.net/npm/papaparse@5.4.1/papaparse.min.js"></script>
  <style>
    .highlight { outline: 3px solid #60a5fa; background: #eff6ff; transition: background 0.4s; }
    .flash { animation: flash 1.2s ease-out 1; }
    @keyframes flash { 0% {background:#fff5cc;} 100% {background:transparent;} }
    .mono { font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", monospace; }
    .rank-badge { min-width:2rem; display:inline-flex; align-items:center; justify-content:center; }
  </style>
</head>
<body class="bg-slate-50 text-slate-900">
  <div class="max-w-5xl mx-auto px-4 py-8">
    <header class="mb-6">
      <h1 class="text-2xl md:text-3xl font-bold">ìŠ¤í”¼ë“œì˜¨ VVIP 3% ìŠˆí¼ ì ë¦½ í˜„í™©(10.31.~11.9)</h1>
      <p class="text-sm text-slate-600 mt-1">â€» ì ë¦½ì€ 11ì›” 23ì¼(ì¼)ê¹Œì§€ ê²½ë¥œê³¼ ê²½ì • ëª¨ë‘ ì ìš©ë©ë‹ˆë‹¤. ë³¸ í˜ì´ì§€ëŠ” ì°¸ê³ ìš©ì´ë©° ìµœì¢… ì ë¦½ì•¡ì€ ë‚´ë¶€ ì •ì‚° ê¸°ì¤€ê³¼ ì œì„¸ê³µê³¼ê¸ˆ ê³µì œì•¡ì— ë”°ë¦…ë‹ˆë‹¤. ì¶”í›„ ì¿ í° ìˆ˜ë ¹ ì‹œ ì§€ê¸‰ëª…ì„¸ì„œ ë™ì˜ê°€ ë°˜ë“œì‹œ í•„ìš”í•©ë‹ˆë‹¤.</p>
    </header>

    <section class="mb-4">
      <label for="search" class="block text-sm font-medium mb-2">ê³ ê°ë‹˜ë³„ ë²ˆí˜¸(1~100) *SMSë¡œ ì•ˆë‚´í•´ë“œë¦° ë²ˆí˜¸ì…ë‹ˆë‹¤.</label>
      <div class="flex gap-2">
        <!-- â‘¤ ëª¨ë°”ì¼ ìˆ«ì í‚¤íŒ¨ë“œ -->
        <input id="search" type="number" inputmode="numeric" pattern="[0-9]*" min="1" max="100" placeholder="ì˜ˆ: 27"
               class="w-full rounded-lg border border-slate-300 px-3 py-2 focus:outline-none focus:ring focus:ring-blue-200" />
        <button id="btnFind"
                class="rounded-lg bg-blue-600 text-white px-4 py-2 hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed">ì°¾ê¸°</button>
      </div>
      <p id="status" class="text-sm text-slate-500 mt-2">ì ì‹œë§Œ ê¸°ë‹¤ë ¤ì£¼ì„¸ìš”.. ê³ ê°ë‹˜ì˜ ìˆœìœ„ëŠ”..?</p>
    </section>

    <!-- Top 10 ê³ ì • ê°•ì¡° ì˜ì—­ -->
    <section class="mb-4">
      <div class="flex items-center justify-between">
        <h2 class="text-lg font-semibold mb-3">ìƒìœ„ 10ìœ„ (ì ë¦½ì•¡ ê¸°ì¤€)</h2>
        <span class="text-xs text-slate-500">â€» ë­í‚¹ = ì˜ˆìƒ ì ë¦½ì•¡(3%) ë‚´ë¦¼ì°¨ìˆœ</span>
      </div>
      <div id="top10" class="grid md:grid-cols-2 gap-3"></div>
    </section>

    <!-- â‘¢ ì •ë ¬ í† ê¸€ ë²„íŠ¼ -->
    <section class="mb-2">
      <div class="flex gap-2">
        <button data-sort="rebate" class="sortbtn px-3 py-1 rounded border bg-white hover:bg-slate-50">ì ë¦½ì•¡ìˆœ</button>
        <button data-sort="bet" class="sortbtn px-3 py-1 rounded border bg-white hover:bg-slate-50">ë² íŒ…ì•¡ìˆœ</button>
        <button data-sort="promo" class="sortbtn px-3 py-1 rounded border bg-white hover:bg-slate-50">ë²ˆí˜¸ìˆœ</button>
      </div>
    </section>

    <!-- ì „ì²´ ë­í‚¹ í…Œì´ë¸” -->
    <section class="overflow-x-auto bg-white rounded-2xl shadow">
      <table class="min-w-full text-sm">
        <thead class="bg-slate-100 text-slate-700">
          <tr>
            <th class="text-left px-4 py-3">ë­í‚¹</th>
            <th class="text-left px-4 py-3">ë²ˆí˜¸</th>
            <th class="text-left px-4 py-3">ì•„ì´ë””(ê°œì¸ì •ë³´ë³´í˜¸)</th>
            <!-- ï¼Šëª¨ë°”ì¼ì—ì„œ ì ë¦½ì•¡ì´ ë¨¼ì € ë³´ì´ë„ë¡ ì»¬ëŸ¼ ìˆœì„œ ë³€ê²½ -->
            <th class="text-right px-4 py-3">ì˜ˆìƒ ì ë¦½ì•¡(3%)</th>
            <!-- ë² íŒ…ì•¡ì€ ëª¨ë°”ì¼ì—ì„  ìˆ¨ê¹€, md ì´ìƒì—ì„œ í‘œì‹œ -->
            <th class="text-right px-4 py-3 hidden md:table-cell">ìŠ¤í”¼ë“œì˜¨ ë² íŒ…ì•¡</th>
          </tr>
        </thead>
        <tbody id="tbody"></tbody>
      </table>
    </section>

    <footer class="mt-6 text-xs text-slate-500">
      <p>â€» ì¿ í° ì ë¦½ê¸ˆì•¡ ìˆœìœ„ëŠ” ì£¼ 1íšŒ ê°±ì‹ ë©ë‹ˆë‹¤. ìµœì¢… ì ë¦½ì•¡ì€ ì œì„¸ê³µê³¼ê¸ˆìœ¼ë¡œ ì¸í•´ ë‹¤ì†Œ ì°¨ì´ê°€ ìˆì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>
    </footer>
  </div>

  <script>
    // âœ… CSV ë§í¬
    const SHEET_URL = "https://docs.google.com/spreadsheets/d/e/2PACX-1vTazsjNo6e1OEyhahhSCR8uXHy2drKWgUa6vpsrL6cpWH9NOQIyTDsP6psIbvC9Dm8kWtPQID385vra/pub?output=csv";

    const statusEl = document.getElementById("status");
    const btn = document.getElementById("btnFind");
    btn.disabled = true;

    // â‘£ ê¸ˆì•¡ íŒŒì‹± ë” ì•ˆì „í•˜ê²Œ
    const cleanMoney = (v) => {
      if (v == null) return 0;
      const s = String(v).replace(/[^\d.-]/g, "");
      const n = Number(s);
      return Number.isFinite(n) ? n : 0;
    };
    const fmt = n => (Number.isFinite(n) ? n.toLocaleString("ko-KR") : "0") + "ì›";

    let rawRows = [];
    let rankedRows = [];

    function computeRanking(rows) {
      // 1) ìˆ«ìí™” + ì ë¦½ì•¡ ê³„ì‚°
      const enriched = rows.map(r => {
        const bet = cleanMoney(r.betSum);
        const rebate = cleanMoney(r["3percent_payback"]) || Math.round(bet * 0.03);
        return {
          promoNo: r.promoNo?.trim(),
          maskedID: r.maskedID?.trim(),
          bet,
          rebate
        };
      });

      // â‘  ë™ë¥  ì²˜ë¦¬ ê°•í™”: ì ë¦½ì•¡ â†“, ë² íŒ…ì•¡ â†“, ë²ˆí˜¸ â†‘, ID ì•ŒíŒŒë²³ â†‘
      enriched.sort((a, b) => {
        if (b.rebate !== a.rebate) return b.rebate - a.rebate;
        if (b.bet !== a.bet) return b.bet - a.bet;
        const an = Number(a.promoNo), bn = Number(b.promoNo);
        if (an !== bn) return an - bn;
        return String(a.maskedID || "").localeCompare(String(b.maskedID || ""), "ko");
      });

      // 3) ë­í¬ ë¶€ì—¬(1ë¶€í„°)
      enriched.forEach((r, idx) => r.rank = idx + 1);
      return enriched;
    }

    function renderTop10(rowsByRank) {
      const top = rowsByRank.slice(0, 10);
      const topWrap = document.getElementById("top10");
      topWrap.innerHTML = top.map(r => {
        const crown = r.rank === 1 ? "ğŸ‘‘ " : (r.rank <= 3 ? "ğŸ… " : "");
        const rankColor = r.rank === 1 ? "bg-yellow-400" : r.rank <= 3 ? "bg-amber-300" : "bg-slate-200";
        return `
          <div class="bg-white rounded-xl border border-slate-200 shadow-sm p-4 flex items-center justify-between">
            <div class="flex items-center gap-3">
              <span class="rank-badge ${rankColor} text-slate-900 rounded-full px-3 py-1 font-bold">${r.rank}</span>
              <div>
                <div class="font-semibold">${crown}<span class="mono">${r.maskedID ?? ""}</span></div>
                <div class="text-xs text-slate-500">ë² íŒ…: ${fmt(r.bet)} / ì ë¦½: <span class="font-semibold">${fmt(r.rebate)}</span></div>
                <div class="text-[11px] text-slate-400 mt-0.5">ê³ ê°ë²ˆí˜¸: ${r.promoNo ?? "-"}</div>
              </div>
            </div>
            <button data-jump="${r.promoNo}" class="text-xs px-2 py-1 rounded border hover:bg-slate-50">í‘œì—ì„œ ë³´ê¸°</button>
          </div>`;
      }).join("");

      // Top10 ì¹´ë“œì˜ "í‘œì—ì„œ ë³´ê¸°" â†’ í•´ë‹¹ ë²ˆí˜¸ í–‰ìœ¼ë¡œ ìŠ¤í¬ë¡¤
      topWrap.querySelectorAll("[data-jump]").forEach(btn => {
        btn.addEventListener("click", e => {
          const no = e.currentTarget.getAttribute("data-jump");
          highlightPromo(no, true);
        });
      });
    }

    function renderTable(rowsByRank) {
      const tbody = document.getElementById("tbody");
      tbody.innerHTML = "";
      for (const r of rowsByRank) {
        const tr = document.createElement("tr");
        tr.className = "border-t";
        tr.dataset.promo = r.promoNo; // ê²€ìƒ‰ìš© ì‹ë³„ì€ ê³„ì† 'ë²ˆí˜¸'
        const strongClass = r.rank <= 10 ? "font-semibold" : "";
        tr.innerHTML = `
          <td class="px-4 py-3 ${strongClass}">${r.rank}</td>
          <td class="px-4 py-3 ${strongClass}">${r.promoNo ?? ""}</td>
          <td class="px-4 py-3 mono ${strongClass}">${r.maskedID ?? ""}</td>
          <!-- â‘¡ ê¸ˆì•¡ë“¤ ì¤„ë°”ê¿ˆ ë°©ì§€ + ë“±í­ ìˆ«ì -->
          <td class="px-4 py-3 text-right whitespace-nowrap tabular-nums font-semibold ${r.rank<=10?'text-blue-700':''}">${fmt(r.rebate)}</td>
          <td class="px-4 py-3 text-right whitespace-nowrap tabular-nums ${strongClass} hidden md:table-cell">${fmt(r.bet)}</td>
        `;
        tbody.appendChild(tr);
      }
    }

    function renderAll() {
      rankedRows = computeRanking(rawRows);
      renderTop10(rankedRows);
      renderTable(rankedRows);
    }

    function highlightPromo(no, fromTop10=false) {
      const n = Number(no);
      if (!n || n < 1 || n > 100) {
        alert("1ë¶€í„° 100 ì‚¬ì´ì˜ ë²ˆí˜¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”.");
        return;
      }
      document.querySelectorAll("#tbody tr").forEach(tr => tr.classList.remove("highlight","flash"));
      const target = document.querySelector(`#tbody tr[data-promo='${n}']`);
      if (target) {
        target.classList.add("highlight","flash");
        target.scrollIntoView({ behavior: "smooth", block: "center" });
        if (fromTop10) document.getElementById("search").value = n;
      } else {
        alert("í•´ë‹¹ ë²ˆí˜¸ê°€ ì—†ìŠµë‹ˆë‹¤.");
      }
    }

    function loadData() {
      statusEl.textContent = "ë°ì´í„° ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘â€¦";
      Papa.parse(SHEET_URL + (SHEET_URL.includes("?") ? "&" : "?") + "t=" + Date.now(), {
        download: true,
        header: true,
        skipEmptyLines: true,
        complete: (res) => {
          rawRows = res.data.map(row => ({
            promoNo: row.promoNo,
            maskedID: row.maskedID,
            betSum: row.betSum,
            "3percent_payback": row["3percent_payback"]
          }));
          renderAll();
          statusEl.textContent = `ì´ ${rawRows.length}ê±´ ë¡œë“œë¨ (ì ë¦½ì•¡ ê¸°ì¤€ ë­í‚¹ ì‚°ì •)`;
          btn.disabled = false;

          // â‘¥ ë”¥ë§í¬ í›„ ì£¼ì†Œ ì •ë¦¬
          const params = new URLSearchParams(location.search);
          const queryNo = params.get("no");
          if (queryNo) {
            highlightPromo(queryNo);
            history.replaceState({}, "", location.pathname);
          }
        },
        error: (err) => {
          console.error(err);
          statusEl.textContent = "ì‹œíŠ¸ ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ì§€ ëª»í–ˆìŠµë‹ˆë‹¤. ì ì‹œ í›„ ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.";
        }
      });
    }

    document.getElementById("btnFind").addEventListener("click", () => {
      const no = document.getElementById("search").value.trim();
      highlightPromo(no);
    });
    document.getElementById("search").addEventListener("keydown", (e) => {
      if (e.key === "Enter") document.getElementById("btnFind").click();
    });
    // â‘¤ ëª¨ë°”ì¼ í¬ì»¤ìŠ¤ ì‹œ ì‚´ì§ ìƒë‹¨ ì´ë™(í‚¤ë³´ë“œë¡œ ê°€ë ¤ì§€ëŠ” ê²ƒ ë°©ì§€ìš©)
    document.getElementById("search").addEventListener("focus",()=>{
      setTimeout(()=> window.scrollTo({top: 0, behavior:"smooth"}), 50);
    });

    // â‘¢ ì •ë ¬ í† ê¸€ ë¦¬ìŠ¤ë„ˆ
    document.querySelectorAll('.sortbtn').forEach(b=>{
      b.addEventListener('click', e=>{
        const k = e.currentTarget.dataset.sort;
        let rows = [...rankedRows];
        if (k === 'bet') {
          rows.sort((a,b)=> b.bet - a.bet || a.rank - b.rank);
        } else if (k === 'promo') {
          rows.sort((a,b)=> Number(a.promoNo) - Number(b.promoNo));
        } else {
          rows = computeRanking(rawRows); // ì ë¦½ì•¡ìˆœ(ê¸°ë³¸)
        }
        renderTop10(rows);
        renderTable(rows);
      });
    });

    loadData();
  </script>
</body>
</html>
