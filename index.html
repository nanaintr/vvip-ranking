<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>ì˜¨ë¼ì¸ VVIP 3% ìŠˆí¼ ì ë¦½ í˜„í™©</title>
  <meta name="robots" content="noindex,nofollow" />
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdn.jsdelivr.net/npm/papaparse@5.4.1/papaparse.min.js"></script>
  <style>
    .highlight { outline: 3px solid #60a5fa; background: #eff6ff; transition: background 0.4s; }
    .flash { animation: flash 1.2s ease-out 1; }
    @keyframes flash { 0% {background:#fff5cc;} 100% {background:transparent;} }
    .mono { font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", monospace; }
    .rank-badge { min-width:2rem; display:inline-flex; align-items:center; justify-content:center; }
  </style>
</head>
<body class="bg-slate-50 text-slate-900">
  <div class="max-w-5xl mx-auto px-4 py-8">
    <header class="mb-6">
      <h1 class="text-2xl md:text-3xl font-bold">VVIP ì˜¨ë¼ì¸ 3% ì ë¦½ í˜„í™©</h1>
      <p class="text-sm text-slate-600 mt-1">â€» ë³¸ í˜ì´ì§€ëŠ” ì°¸ê³ ìš©ì´ë©° ìµœì¢… ì ë¦½ì•¡ì€ ë‚´ë¶€ ì •ì‚° ê¸°ì¤€ì— ë”°ë¦…ë‹ˆë‹¤.</p>
    </header>

    <section class="mb-4">
      <label for="search" class="block text-sm font-medium mb-2">í”„ë¡œëª¨ì…˜ ë²ˆí˜¸(1~100)</label>
      <div class="flex gap-2">
        <input id="search" type="number" min="1" max="100" placeholder="ì˜ˆ: 27"
               class="w-full rounded-lg border border-slate-300 px-3 py-2 focus:outline-none focus:ring focus:ring-blue-200" />
        <button id="btnFind"
                class="rounded-lg bg-blue-600 text-white px-4 py-2 hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed">ì°¾ê¸°</button>
      </div>
      <!-- ë¡œë”©/ì—ëŸ¬ ì•ˆë‚´ -->
      <p id="status" class="text-sm text-slate-500 mt-2">ì ì‹œë§Œ ê¸°ë‹¤ë ¤ì£¼ì„¸ìš”.. ê³ ê°ë‹˜ì˜ ìˆœìœ„ëŠ”..?</p>
    </section>

    <!-- Top 10 ê³ ì • ê°•ì¡° ì˜ì—­ -->
    <section class="mb-6">
      <h2 class="text-lg font-semibold mb-3">ìƒìœ„ 10ìœ„</h2>
      <div id="top10" class="grid md:grid-cols-2 gap-3"></div>
    </section>

    <!-- ì „ì²´ ë­í‚¹ í…Œì´ë¸” -->
    <section class="overflow-x-auto bg-white rounded-2xl shadow">
      <table class="min-w-full text-sm">
        <thead class="bg-slate-100 text-slate-700">
          <tr>
            <th class="text-left px-4 py-3">ë²ˆí˜¸</th>
            <th class="text-left px-4 py-3">ì•„ì´ë””(ê°œì¸ì •ë³´ë³´í˜¸)</th>
            <th class="text-right px-4 py-3">ìŠ¤í”¼ë“œì˜¨ ë² íŒ…ì•¡</th>
            <th class="text-right px-4 py-3">ì˜ˆìƒ ì ë¦½ì•¡(3%)</th>
          </tr>
        </thead>
        <tbody id="tbody"></tbody>
      </table>
    </section>

    <footer class="mt-6 text-xs text-slate-500">
      <p>â€» ë­í‚¹ì€ ì£¼ 1íšŒ ê°±ì‹ ë©ë‹ˆë‹¤. ìµœì¢… ì ë¦½ì•¡ì€ ì œì„¸ê³µê³¼ê¸ˆìœ¼ë¡œ ì¸í•´ ë‹¤ì†Œ ì°¨ì´ê°€ ìˆì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>
    </footer>
  </div>

  <script>
    // âœ… CSV ë§í¬ êµì²´
    const SHEET_URL = "https://docs.google.com/spreadsheets/d/e/2PACX-1vTazsjNo6e1OEyhahhSCR8uXHy2drKWgUa6vpsrL6cpWH9NOQIyTDsP6psIbvC9Dm8kWtPQID385vra/pub?output=csv";

    const statusEl = document.getElementById("status");
    const btn = document.getElementById("btnFind");
    btn.disabled = true;

    const cleanMoney = (v) => {
      if (v == null) return 0;
      const s = String(v).replace(/[^\d.-]/g, "");
      const n = parseFloat(s);
      return isNaN(n) ? 0 : n;
    };
    const fmt = n => n.toLocaleString("ko-KR") + "ì›";

    let allRows = [];

    function render(rows) {
      // ì •ë ¬
      rows.sort((a, b) => Number(a.promoNo) - Number(b.promoNo));

      // Top 10 ì¹´ë“œ ë Œë”
      const top = rows.slice(0, 10);
      const topWrap = document.getElementById("top10");
      topWrap.innerHTML = top.map(r => {
        const bet = cleanMoney(r.betSum);
        const rebate = cleanMoney(r["3percent_payback"]) || Math.round(bet * 0.03);
        const rank = Number(r.promoNo);
        const crown = rank === 1 ? "ğŸ‘‘ " : (rank <= 3 ? "ğŸ… " : "");
        const rankColor = rank === 1 ? "bg-yellow-400" : rank <=3 ? "bg-amber-300" : "bg-slate-200";
        return `
          <div class="bg-white rounded-xl border border-slate-200 shadow-sm p-4 flex items-center justify-between">
            <div class="flex items-center gap-3">
              <span class="rank-badge ${rankColor} text-slate-900 rounded-full px-3 py-1 font-bold">${r.promoNo}</span>
              <div>
                <div class="font-semibold">${crown}<span class="mono">${r.maskedID ?? ""}</span></div>
                <div class="text-xs text-slate-500">ë² íŒ…: ${fmt(bet)} / ì ë¦½: <span class="font-semibold">${fmt(rebate)}</span></div>
              </div>
            </div>
            <button data-jump="${r.promoNo}" class="text-xs px-2 py-1 rounded border hover:bg-slate-50">í‘œì—ì„œ ë³´ê¸°</button>
          </div>`;
      }).join("");

      // ì „ì²´ í…Œì´ë¸” ë Œë”
      const tbody = document.getElementById("tbody");
      tbody.innerHTML = "";
      for (const r of rows) {
        const bet = cleanMoney(r.betSum);
        const rebate = cleanMoney(r["3percent_payback"]) || Math.round(bet * 0.03);
        const tr = document.createElement("tr");
        tr.className = "border-t";
        tr.dataset.promo = r.promoNo;
        const rank = Number(r.promoNo);
        const strongClass = rank <= 10 ? "font-semibold" : "";
        tr.innerHTML = `
          <td class="px-4 py-3 ${strongClass}">${r.promoNo ?? ""}</td>
          <td class="px-4 py-3 mono ${strongClass}">${r.maskedID ?? ""}</td>
          <td class="px-4 py-3 text-right ${strongClass}">${fmt(bet)}</td>
          <td class="px-4 py-3 text-right font-semibold ${rank<=10?'text-blue-700':''}">${fmt(rebate)}</td>
        `;
        tbody.appendChild(tr);
      }

      // Top10 ì¹´ë“œì˜ "í‘œì—ì„œ ë³´ê¸°" í´ë¦­ â†’ í•´ë‹¹ í–‰ìœ¼ë¡œ ìŠ¤í¬ë¡¤
      topWrap.querySelectorAll("[data-jump]").forEach(btn => {
        btn.addEventListener("click", e => {
          const no = e.currentTarget.getAttribute("data-jump");
          highlightPromo(no, true);
        });
      });
    }

    function highlightPromo(no, fromTop10=false) {
      // ì…ë ¥ ë³´ì •
      const n = Number(no);
      if (!n || n < 1 || n > 100) {
        alert("1ë¶€í„° 100 ì‚¬ì´ì˜ ë²ˆí˜¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”.");
        return;
      }
      // ê¸°ì¡´ í•˜ì´ë¼ì´íŠ¸ ì œê±°
      document.querySelectorAll("#tbody tr").forEach(tr => tr.classList.remove("highlight","flash"));
      // ëŒ€ìƒ í–‰ ì°¾ê¸°
      const target = document.querySelector(`#tbody tr[data-promo='${n}']`);
      if (target) {
        target.classList.add("highlight","flash");
        target.scrollIntoView({ behavior: "smooth", block: "center" });
        // ê²€ìƒ‰ì°½ì— ë²ˆí˜¸ ë°˜ì˜(Top10 ì¹´ë“œ í´ë¦­ ì‹œë„ í¬í•¨)
        if (fromTop10) document.getElementById("search").value = n;
      } else {
        alert("í•´ë‹¹ ë²ˆí˜¸ê°€ ì—†ìŠµë‹ˆë‹¤.");
      }
    }

    function loadData() {
      statusEl.textContent = "ë°ì´í„° ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘â€¦";
      Papa.parse(SHEET_URL + (SHEET_URL.includes("?") ? "&" : "?") + "t=" + Date.now(), {
        download: true,
        header: true,
        skipEmptyLines: true,
        complete: (res) => {
          allRows = res.data.map(row => ({
            promoNo: row.promoNo?.trim(),
            maskedID: row.maskedID?.trim(),
            betSum: row.betSum?.trim(),
            "3percent_payback": row["3percent_payback"]?.trim()
          }));
          render(allRows);
          statusEl.textContent = `ì´ ${allRows.length}ê±´ ë¡œë“œë¨`;
          btn.disabled = false;

          // URL ì¿¼ë¦¬ ?no=27 ì§€ì› (ì„ íƒ)
          const params = new URLSearchParams(location.search);
          const queryNo = params.get("no");
          if (queryNo) highlightPromo(queryNo);
        },
        error: (err) => {
          console.error(err);
          statusEl.textContent = "ì‹œíŠ¸ ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ì§€ ëª»í–ˆìŠµë‹ˆë‹¤. ì ì‹œ í›„ ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.";
        }
      });
    }

    document.getElementById("btnFind").addEventListener("click", () => {
      const no = document.getElementById("search").value.trim();
      highlightPromo(no);
    });
    document.getElementById("search").addEventListener("keydown", (e) => {
      if (e.key === "Enter") document.getElementById("btnFind").click();
    });

    loadData();
  </script>
</body>
</html>
